---
phase: 04-dark-light-mode-toggle
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ThemeProvider.tsx
  - src/components/ThemeToggle.tsx
  - src/app/[locale]/layout.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "User sees a toggle button to switch between dark/light modes"
    - "User preference persists across sessions (localStorage)"
    - "System preference is respected by default"
    - "No flash of wrong theme on page load"
    - "No hydration mismatch warnings in console"
  artifacts:
    - path: "src/components/ThemeProvider.tsx"
      provides: "Client-side theme context wrapper"
      min_lines: 10
    - path: "src/components/ThemeToggle.tsx"
      provides: "Theme toggle button with sun/moon icons"
      min_lines: 25
    - path: "src/app/[locale]/layout.tsx"
      provides: "ThemeProvider integration with suppressHydrationWarning"
      contains: "ThemeProvider"
    - path: "src/app/globals.css"
      provides: "Light mode CSS variables"
      contains: ".dark"
  key_links:
    - from: "src/app/[locale]/layout.tsx"
      to: "src/components/ThemeProvider.tsx"
      via: "import and wrap children"
      pattern: "ThemeProvider.*attribute.*class"
    - from: "src/components/ThemeToggle.tsx"
      to: "next-themes"
      via: "useTheme hook"
      pattern: "useTheme.*resolvedTheme"
---

<objective>
Implement dark/light mode toggle using next-themes library.

Purpose: Allow users to switch between dark and light themes based on preference, with system preference respected by default and user choice persisted via localStorage.

Output: Working theme toggle button, ThemeProvider wrapper, and light mode CSS variables.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-dark-light-mode-toggle/04-RESEARCH.md

@src/app/[locale]/layout.tsx
@src/app/globals.css
@src/components/BackToTop.tsx
@tailwind.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install next-themes and create theme components</name>
  <files>
    src/components/ThemeProvider.tsx
    src/components/ThemeToggle.tsx
  </files>
  <action>
1. Run `npm install next-themes` to add the theme management library.

2. Create `src/components/ThemeProvider.tsx`:
   - 'use client' directive at top
   - Import ThemeProvider as NextThemesProvider from 'next-themes'
   - Export ThemeProvider component that wraps NextThemesProvider
   - Accept and forward all props via React.ComponentProps

3. Create `src/components/ThemeToggle.tsx`:
   - 'use client' directive at top
   - Import useState, useEffect from 'react'
   - Import useTheme from 'next-themes'
   - Import AnimatePresence, motion from 'framer-motion'
   - Import Sun, Moon from 'lucide-react'

   Component implementation:
   - Use mounted state pattern to avoid hydration mismatch (useState false, useEffect sets true)
   - Before mounted: return placeholder div with same dimensions (w-11 h-11) to prevent layout shift
   - After mounted: use resolvedTheme (not theme) to determine current state
   - Button styling: Match BackToTop pattern (w-11 h-11, rounded-full, fixed position)
   - Position: fixed bottom-5 right-20 z-30 (left of BackToTop which is at right-5)
   - Use AnimatePresence with mode="wait" for smooth icon transitions
   - Sun icon for dark mode (click switches to light), Moon icon for light mode (click switches to dark)
   - Include aria-label that describes the action ("Switch to light mode" / "Switch to dark mode")
   - Background colors: bg-white/10 hover:bg-white/20 (works for both themes)
  </action>
  <verify>
    - `npm ls next-themes` shows next-themes installed
    - `ls src/components/ThemeProvider.tsx` exists
    - `ls src/components/ThemeToggle.tsx` exists
  </verify>
  <done>
    - next-themes package installed
    - ThemeProvider.tsx exports ThemeProvider component
    - ThemeToggle.tsx exports default function with mounted-state pattern
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate ThemeProvider into layout</name>
  <files>
    src/app/[locale]/layout.tsx
  </files>
  <action>
Update `src/app/[locale]/layout.tsx`:

1. Add import for ThemeProvider from '@/components/ThemeProvider'
2. Add import for ThemeToggle from '@/components/ThemeToggle'

3. Modify the html element:
   - Remove hardcoded className="dark" (next-themes will manage this)
   - Add suppressHydrationWarning prop to prevent React warnings

4. Wrap the content with ThemeProvider (inside body, wrapping NextIntlClientProvider):
   - Props: attribute="class" defaultTheme="system" enableSystem disableTransitionOnChange
   - Keep existing NextIntlClientProvider inside ThemeProvider
   - Keep BackToTop inside the provider

5. Add ThemeToggle component next to BackToTop (both are siblings inside providers)

Result structure:
```
<html lang={locale} suppressHydrationWarning>
  <body className={inter.className}>
    <ThemeProvider attribute="class" defaultTheme="system" enableSystem disableTransitionOnChange>
      <NextIntlClientProvider messages={messages}>
        {children}
        <ThemeToggle />
        <BackToTop />
      </NextIntlClientProvider>
    </ThemeProvider>
  </body>
</html>
```
  </action>
  <verify>
    - `grep -q "suppressHydrationWarning" src/app/[locale]/layout.tsx` returns 0
    - `grep -q "ThemeProvider" src/app/[locale]/layout.tsx` returns 0
    - `grep -q "ThemeToggle" src/app/[locale]/layout.tsx` returns 0
  </verify>
  <done>
    - layout.tsx has suppressHydrationWarning on html element
    - ThemeProvider wraps content with correct props
    - ThemeToggle is rendered alongside BackToTop
    - No hardcoded "dark" class on html element
  </done>
</task>

<task type="auto">
  <name>Task 3: Add light mode CSS variables and styles</name>
  <files>
    src/app/globals.css
  </files>
  <action>
Update `src/app/globals.css`:

1. Modify the :root block to define light mode colors:
   - --background: #fafafa (off-white)
   - --foreground: #0a0a0a (dark text)

2. Add .dark block with dark mode colors (current values):
   - --background: #0a0a0a
   - --foreground: #fafafa

3. Update body styles to use CSS variables instead of hardcoded dark colors:
   - Change `@apply bg-turfu-dark text-white` to use CSS variables
   - Use: `@apply bg-[var(--background)] text-[var(--foreground)] antialiased`

4. Update ::selection to work in both modes:
   - Keep accent color, but make text color work for both themes
   - Use: `@apply bg-turfu-accent/30`

5. Update button focus ring offsets to work in both modes:
   - .btn-primary: Change `focus:ring-offset-turfu-dark` to `focus:ring-offset-[var(--background)]`
   - .btn-secondary: Same change for focus ring offset

Result: Site looks good in both dark (current design) and light modes (off-white background, dark text).
  </action>
  <verify>
    - `npm run build` succeeds without errors
    - `grep -q "\.dark" src/app/globals.css` returns 0 (dark mode block exists)
    - `grep -q "var(--background)" src/app/globals.css` returns 0 (CSS variables used)
  </verify>
  <done>
    - :root defines light mode variables
    - .dark block defines dark mode variables
    - Body uses CSS variables for background and text color
    - Build passes without errors
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Start dev server: `npm run dev`
2. Open http://localhost:3000 in browser
3. Verify dark mode (default if system prefers dark):
   - Dark background, light text
   - Toggle button visible with Sun icon (bottom-right, left of BackToTop)
4. Click toggle button:
   - Theme switches to light mode
   - Button shows Moon icon
   - Light background (#fafafa), dark text
5. Refresh page:
   - Theme persists (localStorage)
   - No flash of wrong theme
6. Check browser console:
   - No hydration mismatch warnings
7. Change system preference (OS settings):
   - Site respects change if user hasn't manually toggled
</verification>

<success_criteria>
- Theme toggle button appears in fixed position (bottom-right, left of BackToTop)
- Clicking toggle switches between dark and light modes
- User preference persists in localStorage across page refreshes
- System preference is respected as default
- No flash of unstyled content (FOUC)
- No React hydration warnings in console
- Both dark and light modes have readable contrast
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-dark-light-mode-toggle/04-01-SUMMARY.md`
</output>
