---
phase: 03-back-to-top
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/BackToTop.tsx
  - src/app/[locale]/layout.tsx
autonomous: true

must_haves:
  truths:
    - "User sees back-to-top button appear after scrolling down ~400px"
    - "User can tap button to smooth-scroll back to page top"
    - "Screen reader users hear accessible label describing button purpose"
  artifacts:
    - path: "src/components/BackToTop.tsx"
      provides: "Floating back-to-top button component"
      min_lines: 40
      contains: "aria-label"
    - path: "src/app/[locale]/layout.tsx"
      provides: "Global layout with BackToTop integration"
      contains: "BackToTop"
  key_links:
    - from: "src/components/BackToTop.tsx"
      to: "window.scrollTo"
      via: "onClick handler"
      pattern: "scrollTo.*behavior.*smooth"
    - from: "src/components/BackToTop.tsx"
      to: "window.scrollY"
      via: "useEffect scroll listener"
      pattern: "addEventListener.*scroll"
    - from: "src/app/[locale]/layout.tsx"
      to: "src/components/BackToTop.tsx"
      via: "import and render"
      pattern: "import BackToTop"
---

<objective>
Implement a floating back-to-top button that appears site-wide after scrolling down, enabling users to quickly return to page top.

Purpose: Long documentation pages need a way for users to quickly navigate back to the top without manual scrolling.
Output: BackToTop.tsx component integrated into global layout, appearing on all pages.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-back-to-top/03-RESEARCH.md
@src/app/[locale]/layout.tsx
@src/components/content/MobileSidebarDrawer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BackToTop component</name>
  <files>src/components/BackToTop.tsx</files>
  <action>
Create a client component with the following implementation:

1. **Scroll detection:**
   - Use `useState` for `isVisible` boolean (initially false)
   - Use `useEffect` with scroll listener, `{ passive: true }` option
   - Set `isVisible = true` when `window.scrollY > 400`
   - Call handler once on mount to set initial state
   - Return cleanup function to remove listener

2. **Animation:**
   - Use `AnimatePresence` from framer-motion wrapping conditional render
   - Use `motion.button` with variants:
     - initial: `{ opacity: 0, scale: 0.8 }`
     - animate: `{ opacity: 1, scale: 1, transition: { duration: 0.2, ease: 'easeOut' } }`
     - exit: `{ opacity: 0, scale: 0.8, transition: { duration: 0.15, ease: 'easeIn' } }`

3. **Scroll to top:**
   - `onClick` calls `window.scrollTo({ top: 0, behavior: 'smooth' })`

4. **Styling:**
   - Position: `fixed bottom-5 right-5 z-30`
   - Size: `w-11 h-11` (44x44px touch target)
   - Shape: `rounded-full`
   - Colors: `bg-turfu-accent hover:bg-turfu-accent/90 text-white`
   - Shadow: `shadow-lg shadow-turfu-accent/25`
   - Focus: `focus:outline-none focus:ring-2 focus:ring-turfu-accent focus:ring-offset-2 focus:ring-offset-turfu-dark`
   - Centering: `flex items-center justify-center`
   - Transition: `transition-colors`

5. **Accessibility:**
   - `aria-label="Back to top"` on button
   - `aria-hidden="true"` on ArrowUp icon
   - Use `ArrowUp` icon from lucide-react with `size={20}`

Follow the complete code example from 03-RESEARCH.md. Do NOT add throttling/debouncing (passive listener is sufficient).
  </action>
  <verify>
File exists at src/components/BackToTop.tsx with:
- `'use client'` directive
- `aria-label="Back to top"`
- `AnimatePresence` and `motion.button`
- scroll listener with passive:true
- cleanup function in useEffect
  </verify>
  <done>
Component file created with scroll detection, animation, accessibility attributes, and proper cleanup.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate BackToTop into global layout</name>
  <files>src/app/[locale]/layout.tsx</files>
  <action>
Modify the [locale]/layout.tsx to render BackToTop site-wide:

1. **Import:**
   ```typescript
   import BackToTop from '@/components/BackToTop';
   ```

2. **Render:**
   Add `<BackToTop />` inside the `<body>` tag, after `{children}`, inside `NextIntlClientProvider`:
   ```tsx
   <NextIntlClientProvider messages={messages}>
     {children}
     <BackToTop />
   </NextIntlClientProvider>
   ```

This placement ensures:
- Button appears on ALL pages (global layout)
- Button has access to any context providers if needed in future
- Button renders after page content (proper DOM order)
  </action>
  <verify>
Run `npm run build` - should complete without errors.
Verify layout.tsx contains:
- `import BackToTop from '@/components/BackToTop'`
- `<BackToTop />` rendered inside body
  </verify>
  <done>
BackToTop component imported and rendered in global layout, appearing on all pages.
  </done>
</task>

</tasks>

<verification>
After completing both tasks:

1. **Build verification:**
   ```bash
   npm run build
   ```
   Should complete with no errors.

2. **Manual testing (dev server):**
   - Start dev server: `npm run dev`
   - Visit any page (e.g., http://localhost:3000/en)
   - Scroll down past 400px
   - Button should fade in at bottom-right
   - Click button
   - Page should smooth-scroll to top
   - Button should fade out when at top

3. **Accessibility check:**
   - Tab to button (should receive focus ring)
   - Screen reader should announce "Back to top"
</verification>

<success_criteria>
- [ ] BackToTop.tsx exists in src/components/
- [ ] Component uses AnimatePresence + motion.button pattern
- [ ] Button has aria-label="Back to top"
- [ ] Icon has aria-hidden="true"
- [ ] Scroll listener has passive:true and cleanup
- [ ] layout.tsx imports and renders BackToTop
- [ ] npm run build succeeds
- [ ] Button appears after scrolling ~400px on any page
- [ ] Button smooth-scrolls to top on click
</success_criteria>

<output>
After completion, create `.planning/phases/03-back-to-top/03-01-SUMMARY.md`
</output>
